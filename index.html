<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Renamer</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; text-align: center; background-color: #f4f4f9; color: #333; }
        .container { border: 2px dashed #ccc; padding: 40px 20px; cursor: pointer; border-radius: 10px; transition: background-color 0.3s; }
        .container:hover { background-color: #e9e9e9; }
        #file-name-input, #file-type-select { padding: 8px; margin: 10px 5px; border-radius: 5px; border: 1px solid #ccc; }
        #rename-button { padding: 10px 20px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 5px; transition: background-color 0.3s; }
        #rename-button:hover { background-color: #0056b3; }
        .warning { color: #d9534f; margin-top: 20px; font-weight: bold; background-color: #fdd; padding: 15px; border-radius: 5px; border: 1px solid #d9534f; }
        #controls { margin-top: 20px; padding: 20px; border: 1px solid #eee; border-radius: 10px; background-color: #fff; }
        .info-row { display: flex; justify-content: center; align-items: center; gap: 10px; margin: 10px 0; }
        #base-name-span { font-weight: bold; }
    </style>
</head>
<body>

    <h1>File Renamer</h1>
    <p>Upload a file to change its name and file type. The new file will be downloaded to your computer.</p>

    <div class="container" id="drop-area">
        <p>Drag & drop a file here, or click to select a file.</p>
        <input type="file" id="file-input" hidden />
    </div>

    <div id="controls" style="display: none;">
        <p>Current file: <strong id="current-file-name"></strong></p>
        <div class="info-row">
            <label for="file-name-input">New name:</label>
            <input type="text" id="file-name-input" placeholder="e.g., new-document" />
            <span>.</span>
            <select id="file-type-select"></select>
        </div>
        
        <button id="rename-button">Rename and Download</button>

        <div class="warning">
            ⚠️ **WARNING**: Changing a file's type (e.g., from `.jpg` to `.txt`) can malform the file and make it unusable.
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('file-input');
        const dropArea = document.getElementById('drop-area');
        const controls = document.getElementById('controls');
        const fileNameInput = document.getElementById('file-name-input');
        const fileTypeSelect = document.getElementById('file-type-select');
        const renameButton = document.getElementById('rename-button');
        const currentFileNameDisplay = document.getElementById('current-file-name');
        let uploadedFile = null;

        // Common file types for the dropdown
        const commonFileTypes = [
            'txt', 'pdf', 'docx', 'xlsx', 'pptx', 'rtf',
            'jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg',
            'mp4', 'mov', 'avi', 'mkv', 'webm',
            'mp3', 'wav', 'flac', 'aac',
            'zip', 'rar', '7z',
            'html', 'css', 'js', 'json', 'py', 'java', 'c', 'cpp', 'sh',
            'exe', 'dll', 'bin'
        ];

        // Populate the dropdown menu
        commonFileTypes.forEach(type => {
            const option = document.createElement('option');
            option.value = type;
            option.textContent = type;
            fileTypeSelect.appendChild(option);
        });

        // Handle file selection via click
        dropArea.addEventListener('click', () => fileInput.click());

        // Handle file drop events
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        dropArea.addEventListener('drop', handleDrop, false);
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        // Handle file selection from input
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        function handleFiles(files) {
            if (files.length === 0) return;
            uploadedFile = files[0];
            const fileName = uploadedFile.name;
            const lastDotIndex = fileName.lastIndexOf('.');
            // Correctly get the base name without the extension
            const baseName = lastDotIndex !== -1 ? fileName.substring(0, lastDotIndex) : fileName;
            const fileType = lastDotIndex !== -1 ? fileName.substring(lastDotIndex + 1) : '';

            currentFileNameDisplay.textContent = fileName;
            fileNameInput.value = baseName;

            // Select the current file type in the dropdown, or add a new option
            if (commonFileTypes.includes(fileType.toLowerCase())) {
                fileTypeSelect.value = fileType.toLowerCase();
            } else {
                const newOption = document.createElement('option');
                newOption.value = fileType;
                newOption.textContent = fileType;
                fileTypeSelect.appendChild(newOption);
                fileTypeSelect.value = fileType;
            }

            controls.style.display = 'block';
        }

        renameButton.addEventListener('click', () => {
            if (!uploadedFile) {
                alert('Please upload a file first.');
                return;
            }

            const newBaseName = fileNameInput.value.trim();
            const newFileType = fileTypeSelect.value.trim();
            
            if (!newBaseName) {
                alert('Please enter a new file name.');
                return;
            }

            // Combine the new base name and the new file type
            const newFileName = `${newBaseName}.${newFileType}`;

            // Create a new File object with the updated name
            const renamedFile = new File([uploadedFile], newFileName, { type: uploadedFile.type });

            // Create a download link for the new file
            const downloadLink = document.createElement('a');
            downloadLink.href = URL.createObjectURL(renamedFile);
            downloadLink.download = newFileName;

            // Trigger the download
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            URL.revokeObjectURL(downloadLink.href); // Clean up the URL object
        });
    </script>

</body>
</html>
